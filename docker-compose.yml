version: "3.8"

services:
  ipfs:
    build:
      context: ./infra/ipfs
    ports:
      - "4001:4001"
      - "5001:5001"
      - "8080:8080"
    volumes:
      - ipfs_staging:/export
      - ipfs_data:/data/ipfs
    restart: unless-stopped
    networks:
      - lasr

  anvil:
    platform: linux/amd64
    build:
      context: ./infra/foundry
    ports:
      - "8545:8545"
    restart: unless-stopped
    networks:
      - lasr

  executable_oracle:
    container_name: executable_oracle
    platform: linux/amd64
    image: ghcr.io/foundry-rs/foundry:latest
    depends_on:
      - anvil
    volumes:
      - ./executable-oracle-eth:/executable-oracle-eth
    entrypoint: /bin/sh
    command:
      - "-c"
      - |
        echo "Hello from the inline shell script!"
        # Additional shell commands can go here
        # cat /executable-oracle-eth/script/Deploy.s.sol 
        forge script /executable-oracle-eth/script/Deploy.s.sol --broadcast --fork-url http://anvil:8545;
        # forge --version  # This is an example command; replace with the command you need
    networks:
      - lasr

  lasr:
    build:
      context: .
    ports:
      - "8000:8000"
    environment:
      - SECRET_KEY=ac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80
      - BLOCKS_PROCESSED_PATH="/data/blocks_processed.dat"
    volumes:
      - lasr_data:/data
    networks:
      - lasr

networks:
  lasr:

volumes:
  ipfs_staging:
  ipfs_data:
  lasr_data:
